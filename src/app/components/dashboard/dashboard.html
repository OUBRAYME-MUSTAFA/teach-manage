<div dir="rtl">

  <!-- Show Upload only if no files uploaded yet -->
  <app-ExcelUploadComponent
    *ngIf="excelFiles.length === 0"
    (dataParsed)="handleMultipleFiles($event)">
  </app-ExcelUploadComponent>

  <!-- Button to add more classes/files, only shown if already have files -->
  <div *ngIf="excelFiles.length > 0" class="mb-3">
    <button class="btn btn-success" (click)="showUpload = true">+ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</button>
  </div>

  <!-- Conditional upload component when adding more files -->
  <app-ExcelUploadComponent
    *ngIf="showUpload"
    (dataParsed)="handleAddMoreFiles($event); showUpload = false">
  </app-ExcelUploadComponent>

  <p *ngIf="data.length === 0 && excelFiles.length === 0" class="center-text">No data yet. Upload an Excel file above.</p> 

<div *ngIf="excelFiles.length > 0">
  <!-- âœ… Shared Metadata Block (excluding class name) -->
<div *ngIf="excelFiles.length > 0">
  <div class="card mb-3">
  <div class="card-header bg-info text-white">ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù</div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-4 mb-2"><strong>ğŸ§‘â€ğŸ« Ø§Ù„Ø£Ø³ØªØ§Ø°:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.teacher }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ“˜ Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.subject }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ« Ø§Ù„Ù…Ø¤Ø³Ø³Ø©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.school }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ“ Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.level }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ¢ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.academy }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ“ Ù….Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…ÙŠØ©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.region }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ“… Ø§Ù„Ø¯ÙˆØ±Ø©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.semester }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ—“ï¸ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.year }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ—“ï¸  Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ¯:</strong> {{ excelFiles[selectedClassIndex]?.data?.length }} </div>

    </div>
  </div>
</div>

</div>

  <!-- Class Switch Buttons -->
  <div class="mb-3">
    <button
      *ngFor="let file of excelFiles; let i = index"
      (click)="selectedClassIndex = i"
      [class.active]="selectedClassIndex === i"
      class="btn btn-outline-primary me-2 mb-2"
    >
      {{ file.className || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù…' }}
    </button>
  </div>

  <!-- Table for selected class -->
  <div *ngIf="excelFiles[selectedClassIndex]">
    <h4>ğŸ“˜ Ø§Ù„Ù‚Ø³Ù…: {{ excelFiles[selectedClassIndex].className }}</h4>

    <div class="table-wrapper overflow-auto">
      <table border="1" class="table table-striped">
        <thead>
  <tr>
    <th *ngFor="let header of getTableHeaders(selectedClassIndex)">
      {{ header }}
    </th>
  </tr>
</thead>
<tbody>
  <tr *ngFor="let student of excelFiles[selectedClassIndex].data">
    <td *ngFor="let header of getTableHeaders(selectedClassIndex)">
      {{ student[header] }}
    </td>
  </tr>
</tbody>

      </table>
    </div>
  </div>

</div>
</div>
