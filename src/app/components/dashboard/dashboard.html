<div dir="rtl">

  <!-- Show Upload only if no files uploaded yet -->
   <div class="mb-4">  
            <app-ExcelUploadComponent
            *ngIf="excelFiles.length === 0"
            (dataParsed)="handleMultipleFiles($event)">

          </app-ExcelUploadComponent>
  </div>

<p 
  *ngIf="data.length === 0 && excelFiles.length === 0" 
  class="center-text mt-3"
>
  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„Ù Excel Ø£Ø¹Ù„Ø§Ù‡.
</p>
<!-- 
  <div *ngIf="excelFiles.length > 0" class="mb-3">
    <button class="btn btn-success" (click)="showUpload = true">+ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</button>
  </div>


  <app-ExcelUploadComponent
    *ngIf="showUpload"
    (dataParsed)="handleAddMoreFiles($event); showUpload = false">
  </app-ExcelUploadComponent> -->
  
<!-- âœ… Button to add more classes/files -->
<div *ngIf="excelFiles.length > 0" class="mb-3 text-center">
  <button class="btn btn-success" (click)="openUploadModal()">+ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</button>
</div>

<!-- âœ… Modal overlay -->
<div class="modal fade show d-block" *ngIf="showUpload" tabindex="-1" style="background: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">ğŸ“‚ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</h5>
        <!-- <button type="button" class="btn-close" (click)="closeUploadModal()"></button> -->
      </div>
      <div class="modal-body">
        <!-- Upload component inside the modal -->
        <app-ExcelUploadComponent
          (dataParsed)="handleAddMoreFiles($event); closeUploadModal()">
        </app-ExcelUploadComponent>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeUploadModal()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
</div>



<div *ngIf="excelFiles.length > 0">
  <!-- âœ… Shared Metadata Block (excluding class name) -->
<div *ngIf="excelFiles.length > 0">
  <div class="card mb-3">
  <div class="card-header bg-info text-white">ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù</div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-4 mb-2"><strong>ğŸ§‘â€ğŸ« Ø§Ù„Ø£Ø³ØªØ§Ø°:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.teacher }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ“˜ Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.subject }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ« Ø§Ù„Ù…Ø¤Ø³Ø³Ø©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.school }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ“ Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.level }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ¢ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.academy }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ“ Ù….Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…ÙŠØ©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.region }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ“… Ø§Ù„Ø¯ÙˆØ±Ø©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.semester }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ—“ï¸ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.year }} </div>
      <div class="col-md-4 mb-2"><strong>ğŸ—“ï¸  Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ¯:</strong> {{ excelFiles[selectedClassIndex]?.data?.length }} </div>

    </div>
  </div>
</div>

</div>

  <!-- Class Switch Buttons -->
  <div class="mb-3">
    <button
      *ngFor="let file of excelFiles; let i = index"
      (click)="selectedClassIndex = i"
      [class.active]="selectedClassIndex === i"
      class="btn btn-outline-primary me-2 mb-2"
    >
      {{ file.className || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù…' }}
    </button>
  </div>

  <!-- Table for selected class -->
  <div *ngIf="excelFiles[selectedClassIndex]">
    <h4>ğŸ“˜ Ø§Ù„Ù‚Ø³Ù…: {{ excelFiles[selectedClassIndex].className }}</h4>

    <div class="table-wrapper overflow-auto">
      <table border="1" class="table table-striped">
        <thead>
  <tr>
    <th *ngFor="let header of getTableHeaders(selectedClassIndex)">
      {{ header }}
    </th>
  </tr>
</thead>
<tbody>
  <tr *ngFor="let student of excelFiles[selectedClassIndex].data">
    <td *ngFor="let header of getTableHeaders(selectedClassIndex)">
      {{ student[header] }}
    </td>
  </tr>
</tbody>

      </table>
    </div>
  </div>

</div>
</div>
