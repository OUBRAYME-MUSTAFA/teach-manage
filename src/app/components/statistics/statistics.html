<div dir="rtl">
     <!-- âœ… Shared Metadata Block (excluding class name) -->

     <!-- âœ… Add Section Button -->
<div *ngIf="excelFiles.length > 0" class="mb-3 text-center">
  <button class="btn btn-success" (click)="openUploadModal()">+ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</button>
</div>
<!-- âœ… Upload Modal -->
<div class="modal fade show d-block" *ngIf="showUpload" tabindex="-1" style="background: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">ğŸ“‚ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</h5>
        <button type="button" class="btn-close" (click)="closeUploadModal()"></button>
      </div>
      <div class="modal-body">
        <app-ExcelUploadComponent
          (dataParsed)="handleAddMoreFiles($event); closeUploadModal()">
        </app-ExcelUploadComponent>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeUploadModal()">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>
</div>

<div id="contentToExport" dir="rtl">


                <div *ngIf="excelFiles.length; else showDashboard" > 
                        <div class="card mb-3">
                  <div class="card-header bg-info text-white">ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù</div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-4 mb-2"><strong>ğŸ§‘â€ğŸ« Ø§Ù„Ø£Ø³ØªØ§Ø°:</strong> {{ excelFiles[0]?.metadata?.teacher }} </div>
                      <div class="col-md-4 mb-2"><strong>ğŸ“˜ Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> {{ excelFiles[0]?.metadata?.subject }} </div>
                      <div class="col-md-4 mb-2"><strong>ğŸ« Ø§Ù„Ù…Ø¤Ø³Ø³Ø©:</strong> {{ excelFiles[0]?.metadata?.school }} </div>

                      <!-- Uncomment if needed -->
                      <!-- <div class="col-md-4 mb-2"><strong>ğŸ“ Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</strong> {{ excelFiles[selectedClassIndex]?.metadata?.level }} </div> -->

                      <div class="col-md-4 mb-2"><strong>ğŸ¢ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©:</strong> {{ excelFiles[0]?.metadata?.academy }} </div>
                      <div class="col-md-4 mb-2"><strong>ğŸ“ Ù….Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…ÙŠØ©:</strong> {{ excelFiles[0]?.metadata?.region }} </div>
                      <div class="col-md-4 mb-2"><strong>ğŸ“… Ø§Ù„Ø¯ÙˆØ±Ø©:</strong> {{ excelFiles[0]?.metadata?.semester }} </div>
                      <div class="col-md-4 mb-2"><strong>ğŸ—“ï¸ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</strong> {{ excelFiles[0]?.metadata?.year }} </div>
                    </div>
                  </div>
                </div>


                        <!-- Centered Header -->
                        <h4 class="text-center fw-bold mt-4">Ø¬Ø¯ÙˆÙ„ Ù…Ù„Ø®Øµ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:</h4>
                  <div class="checkbox-grid">
                      <div class="mb-3"  *ngIf="availableClasses.length > 0">
                        
                        <label><strong>Ø§Ø®ØªØ± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… &nbsp; &nbsp;:</strong></label>
                            <div class="checkbox-grid">
                              <div *ngFor="let cls of uniqueClasses">
                              <input type="checkbox" [(ngModel)]="selectedClasses[cls]" 
                              (ngModelChange)="updateChart()"  /> {{ cls }}
                            </div>
                          </div>
                        </div>
                      
                      <div class="mb-3">
                        <label><strong>Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙˆØ¶&nbsp; &nbsp;:</strong></label>
                        <div class="checkbox-grid">
                              <div *ngFor="let col of availableStatsColumns">
                                <input type="checkbox" [(ngModel)]="selectedStats[col]" 
                                (ngModelChange)="updateChart()" /> {{ col }}
                              </div>
                        </div>
                      </div>
                  </div>

                  

                <div class="table-wrapper overflow-auto" >
                  <h4 class="text-center fw-bold mt-4">ğŸ“Š Ø£Ø¹Ù„Ù‰ ÙˆØ£Ø¯Ù†Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·</h4>
                  <table border="1" class="table table-striped text-center">
                  <thead>
                    <tr>
                      <th rowspan="2">Ø§Ù„Ù‚Ø³Ù…</th>
                      <th *ngFor="let col of getSelectedColumns()" colspan="2">{{ col }}</th>
                    </tr>
                    <tr>
                      <ng-container *ngFor="let col of getSelectedColumns()">
                        <th>Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø©</th>
                        <th>Ø£Ø¯Ù†Ù‰ Ù†Ù‚Ø·Ø©</th>
                      </ng-container>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let file of getFilteredExcelFiles()"> 
                      <td>{{ file.className || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù…' }}</td>
                      <ng-container *ngFor="let col of getSelectedColumns()">
                        <td>{{ getMax(file.data, col) }}</td>
                        <td>{{ getMin(file.data, col) }}</td>
                      </ng-container>
                    </tr>
                  </tbody>
                </table>


                <h4 class="text-center fw-bold mt-4">ğŸ§® ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø­Ø³Ø¨ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h4>
                <div class="table-responsive" style="overflow-x: auto;">
                <table border="1" class="table table-striped text-center">
                  <thead>
                    <tr>
                      <th rowspan="2">Ø§Ù„Ù‚Ø³Ù…</th>
                      <th *ngFor="let col of getSelectedColumns()" [attr.colspan]="scoreIntervals.length">
                        {{ col }}
                      </th>
                    </tr>
                    <tr>
                      <ng-container *ngFor="let col of getSelectedColumns()">
                        <th *ngFor="let interval of scoreIntervals">{{ interval.label }}</th>
                      </ng-container>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let file of getFilteredExcelFiles()">
                      <td>{{ file.className || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù…' }}</td>
                      <ng-container *ngFor="let col of getSelectedColumns()">
                        <td *ngFor="let interval of scoreIntervals">
                {{ getStudentCountForInterval(file.data, col, interval) }}
                </td>
                      </ng-container>
                    </tr>
                  </tbody>
                </table>
                </div>
                <h4 class="text-center fw-bold mt-4">ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ø­Ø§ØµÙ„ÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø¯Ù„  </h4>

                <table border="1" class="table table-striped text-center">
                  <thead>
                    <tr>
                      <th>Ø§Ù„Ù‚Ø³Ù…</th>
                      <th *ngFor="let col of getSelectedColumns()">{{ col }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let file of getFilteredExcelFiles()">
                      <td>{{ file.className || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù…' }}</td>
                      <td *ngFor="let col of getSelectedColumns()">
                        {{ getPercentageAboveOrEqualTen( file.className, col,file.data) }} 
                      </td>
                    </tr>
                  </tbody>
                </table>


                <!-- Class filters -->

                <h4 class="text-center fw-bold mt-4">ğŸ“Š Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ø§Ù„Ø­Ø§ØµÙ„ÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø¯Ù„</h4>
                <div style="display: block; width: 100%; overflow-x: auto;">
                  <canvas baseChart
                          [data]="barChartData"
                          [options]="barChartOptions"
                          [type]="barChartType">
                  </canvas>
                </div>

</div>


<div class="d-flex justify-content-center mb-3">
  <button class="btn btn-danger me-2" (click)="downloadPDF7()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ PDF</button>
  <button class="btn btn-secondary" (click)="downloadPDF2()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>


<!-- 
<table border="1" class="table table-striped text-center">
  <thead>
    <tr>
      <th>Ø§Ù„Ù‚Ø³Ù…</th>
      <th>Ø§Ù„ÙØªØ±Ø©</th>
      <th *ngFor="let col of getSelectedColumns()">{{ col }}</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngFor="let file of getFilteredExcelFiles()">
      <tr *ngFor="let interval of scoreIntervals; let i = index">
        <td *ngIf="i === 0" [attr.rowspan]="scoreIntervals.length">
          {{ file.className || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù…' }}
        </td>
        <td>{{ interval.label }}</td>
        <td *ngFor="let col of getSelectedColumns()">
          {{ getStudentCountForInterval(file.data, col, interval) }}
        </td>
      </tr>
    </ng-container>
  </tbody>
</table> -->



<!-- /------------------------------------------- -->
<!-- <div *ngFor="let file of getFilteredExcelFiles()" >
  <h3>Ø§Ù„Ù‚Ø³Ù…: {{ file.className || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù…' }}</h3>
  <table border="1" class="table table-striped text-center">
    <thead>
      <tr>
        <th>Ø§Ù„ÙØªØ±Ø©</th>
        <th *ngFor="let col of getSelectedColumns()">{{ col }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let interval of scoreIntervals">
        <td>{{ interval.label }}</td>
        <td *ngFor="let col of getSelectedColumns()">
          {{ getStudentCountForInterval(file.data, col, interval) }}
        </td>
      </tr>
    </tbody>
  </table>
</div> -->
</div>
</div>
</div>

<ng-template #showDashboard>
  <app-dashboard></app-dashboard>
</ng-template>
